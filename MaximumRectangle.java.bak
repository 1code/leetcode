public class Solution {
    public int maximalRectangle(char[][] matrix) {
        // Start typing your Java solution below
        // DO NOT write main() function
        int rowNum = matrix.length;
        if(matrix.length < 1)
            return 0;
        int colNum = matrix[0].length;
        int max = 0;
        for(int i = 0; i < colNum; i++){
            int[] lengths = new int[rowNum];
            Stack<Integer> st = new Stack<Integer>();
            int[] areas = new int[rowNum];
            
            int length, left, right;
            
            for(int j = 0; j < rowNum; j++){
                length = 0;
                while(i + length < colNum && matrix[j][i+length] == '1')
                    length++;
                lengths[j] = length;
                while(!st.isEmpty()){
                    if(length <= lengths[st.peek()])
                        st.pop();
                    else
                        break;
                }
                if(!st.isEmpty())
                    left = st.peek() + 1;
                else
                    left = 0;
                areas[j] = j - left + 1;
                st.push(j);
            }
            
            while(!st.isEmpty())
                st.pop();
            for(int j = rowNum - 1; j >= 0; j--){
                length = 0;
                while(i + length < colNum && matrix[j][i+length] == '1')
                    length++;
                while(!st.isEmpty()){
                    if(length <= lengths[st.peek()])
                        st.pop();
                    else
                        break;
                }
                if(!st.isEmpty())
                    right = st.peek() - 1;
                else
                    right = rowNum - 1;
                areas[j] += right - j;
                st.push(j);
            }
            
            for(int j = 0; j < rowNum; j++)
                max = Math.max(areas[j] * lengths[j],max);
        }
        return max;
    }
}